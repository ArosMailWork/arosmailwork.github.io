---
title: Shader Graph lÃ  khÃ´ng Ä‘á»§ ? thá»­ HLSL nhÃ© ?
description: HLSL, má»Ÿ khÃ³a tiá»m nÄƒng má»›i
author: ArosTheDev
date: 2025-2-15 00:00:00 +0700
categories: [Tutorial, Shader, Vietnamese]
tags: [Tutorial, Shader, Vietnamese]
---

Lá»i Ä‘áº§u mÃ¬nh muá»‘n nÃ³i trong bÃ i blog nÃ y lÃ  cáº£m Æ¡n Ä‘Ã£ báº¥m vÃ o bÃ i post giáº­t tÃ­t Ä‘áº§u nÃ y, mong lÃ  nÃ³ sáº½ giÃºp Ã­ch gÃ¬ Ä‘Ã³ cho má»i ngÆ°á»i

## Shader Graph vÃ  giá»›i háº¡n cá»§a nÃ³ 

Náº¿u mÃ  cÃ¡c báº¡n tá»«ng mÃ² qua vá» shader graph thÃ¬ sáº½ tháº¥y nÃ³ ráº¥t lÃ  tiá»‡n trong viá»‡c sá»­ dá»¥ng vÃ  thÃ¢n thiá»‡n vá»›i ngÆ°á»i dÃ¹ng
Táº¥t nhiÃªn lÃ  nÃ³ váº«n ráº¥t lÃ  Ä‘Ã¡ng tin tuy nhiÃªn náº¿u muá»‘n lÃ m 1 cÃ¡i hiá»‡u á»©ng gÃ¬ Ä‘Ã³ nÃ³ hoÃ nh tÃ¡ trÃ ng hÆ¡n ná»¯a nhÆ° lÃ  ........ má»™t lÃ¡ bÃ i 2 khÃ´ng gian cháº³ng háº¡n ?

*gif here*

Äá»‘i vá»›i shader graph chay thÃ¬ cháº¯c lÃ  chá»‹u cháº¿t, cÃ²n náº¿u dÃ¹ng node custom Function thÃ¬ báº¡n sáº½ pháº£i Ä‘Ã o sÃ¢u hÆ¡n tháº¿ vÃ  cá»¥ thá»ƒ chÃ­nh lÃ  HLSL!!!

ÄÃ¢y chÃ­nh lÃ  cÃ¡ch mÃ  bá»™ cÃ´ng cá»¥ shader graph thÆ°á»ng hay dÃ¹ng Ä‘á»ƒ láº¥p liáº¿m cho nhá»¯ng thá»© mÃ  khÃ´ng há» cÃ³ node sáºµn,
táº¥t nhiÃªn lÃ  cÃ²n 1 cÃ¡ch ná»¯a Ä‘Ã³ lÃ  sá»­ dá»¥ng nhá»¯ng plugin tÆ°Æ¡ng tá»± shader graph nhÆ° Amplify Shader, 
nhÆ°ng khi chÃºng ta tá»›i vá»›i nhá»¯ng hiá»‡u á»©ng phá»©c táº¡p hÆ¡n nhÆ° volumetric fog thÃ¬ nhá»¯ng giá»›i háº¡n tÆ°Æ¡ng tá»± cÅ©ng sáº½ xáº£y ra.

Váº­y, lÃ m cÃ¡ch nÃ o Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ táº¡o Ä‘Æ°á»£c nhá»¯ng thá»© kinh khá»§ng hÆ¡n tháº¿ ?

---

## LÃ½ Thuyáº¿t
Xin giá»›i thiá»‡u vá»›i cÃ¡c Ä‘á»™c giáº£, Ä‘Ã¢y lÃ  HLSL (High-Level Shading Language)

Cáº¥u táº¡o cá»§a 1 shader khi nhÃ¬n vÃ o cÅ©ng khÃ¡ lÃ  Ä‘Æ¡n giáº£n

Giá» hÃ£y thá»­ táº¡o 1 shader máº·c Ä‘á»‹nh cá»§a unity Ä‘á»ƒ dá»… hÃ¬nh dung hÆ¡n

### 1. **Táº¡o Shader Má»›i**:  

   - Trong Unity, chuyá»ƒn Ä‘áº¿n tab **Project** (thÆ°á»ng á»Ÿ phÃ­a dÆ°á»›i mÃ n hÃ¬nh).  
   - Nháº¥p chuá»™t pháº£i vÃ o thÆ° má»¥c **Assets** hoáº·c thÆ° má»¥c con mÃ  báº¡n muá»‘n lÆ°u shader.  
   - Chá»n **Create > Shader > Unlit Shader**.

### 2. **Äáº·t TÃªn Cho Shader**:  

   - Sau khi chá»n xong, Unity sáº½ táº¡o ra má»™t file shader má»›i.  
   - Äáº·t tÃªn file shader lÃ  `BasicShader.shader` hoáº·c `BasicShader`.

### 3. **Má»Ÿ Shader Vá»«a Táº¡o**:  

   - Nháº¥p Ä‘Ãºp chuá»™t vÃ o file `BasicShader.shader` Ä‘á»ƒ má»Ÿ nÃ³ báº±ng Code IDE (Visual Studio hoáº·c VSCode).

### 4. **Cáº¥u TrÃºc Shader Ban Äáº§u**:  

    LÃºc nÃ y, code cá»§a shader sáº½ trÃ´ng nhÆ° sau (Ä‘Ã¢y lÃ  máº«u cÆ¡ báº£n Unity cung cáº¥p):

    ```csharp
    Shader "Unlit/BasicShader"
    {
        Properties
        {
            _MainTex ("Texture", 2D) = "white" {}
        }
        SubShader
        {
            Tags { "RenderType"="Opaque" }
            LOD 100

            Pass
            {
                CGPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                // make fog work
                #pragma multi_compile_fog

                #include "UnityCG.cginc"

                struct appdata
                {
                    float4 vertex : POSITION;
                    float2 uv : TEXCOORD0;
                };

                struct v2f
                {
                    float2 uv : TEXCOORD0;
                    UNITY_FOG_COORDS(1)
                    float4 vertex : SV_POSITION;
                };

                sampler2D _MainTex;
                float4 _MainTex_ST;

                v2f vert (appdata v)
                {
                    v2f o;
                    o.vertex = UnityObjectToClipPos(v.vertex);
                    o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                    UNITY_TRANSFER_FOG(o,o.vertex);
                    return o;
                }

                fixed4 frag (v2f i) : SV_Target
                {
                    // sample the texture
                    fixed4 col = tex2D(_MainTex, i.uv);
                    // apply fog
                    UNITY_APPLY_FOG(i.fogCoord, col);
                    return col;
                }
                ENDCG
            }
        }
    }
   ```

   Giá» hÃ£y cÃ¹ng phÃ¢n tÃ­ch qua cáº¥u trÃºc cá»§a 1 file Shader nhÃ©, vá»›i 1 vÃ i quáº¹t xÃ³a Ä‘i chÃºng ta sáº½ cÃ³:

   ```csharp
    Shader "Custom/BasicShader"
    {
        Properties
        {
            _MainTex ("Texture", 2D) = "white" {}
        }

        SubShader
        {
            Cull Off ZWrite Off ZTest Always    //thuá»™c tÃ­nh ngoÃ i cÃ³ thá»ƒ dÃ¹ng trong shader
            LOD 200                             //thuá»™c tÃ­nh ngoÃ i cÃ³ thá»ƒ dÃ¹ng trong shader

            Tags { "RenderType"="Opaque" }
            
            Pass
            {
                CGPROGRAM

                #pragma vertex vert
                #pragma fragment frag

                #include "UnityCG.cginc"

                struct appdata
                { };

                struct v2f
                { };

                sampler2D _MainTex;
                float4 _MainTex_ST;

                v2f vert (appdata v)
                {
                }

                fixed4 frag (v2f i) : SV_Target
                {
                }

                ENDCG
            }
        }

        
        Fallback "Standard"
    }
```

ÄÃ¢y chÃ­nh lÃ  cáº¥u trÃºc cÆ¡ báº£n cá»§a 1 file shader:

- Properties: nÆ¡i show ra cÃ¡c giÃ¡ trá»‹ view trÃªn inspector, tÃ¹y Ã½, khÃ´ng nháº¥t thiáº¿t pháº£i cÃ³
- SubShader: Khu vá»±c chá»©a cÃ¡c Pass (cÃ¡i nÃ y sáº½ cÃ²n Ä‘Æ°á»£c nháº¯c láº¡i trong 1 bÃ i vá» Replacement Shader)

+ Pass: Chá»©a cÃ¡c bÆ°á»›c thá»±c thi cho vertex shader hoáº·c fragment shader (Surface Shader khÃ´ng pháº£i 1 shader láº», sáº½ Ä‘Æ°á»£c lÃ m rÃµ trong 1 bÃ i nÃ³i vá» low-level graphic programming)

**ğŸ“ NOTE:**  
> Má»™t sá»‘ thuá»™c tÃ­nh render (khÃ´ng cÃ³ trong file gen máº·c Ä‘á»‹nh)
Cull Off, ZWrite Off, ZTest Always, LOD : 1 sá»‘ thuá»™c tÃ­nh khÃ¡c liÃªn quan tá»›i render (máº¥y cÃ¡i nÃ y ráº¥t Ä‘a dáº¡ng vÃ  loáº±ng ngoáº±ng, sáº½ cÃ³ nhá»¯ng hiá»‡u á»©ng sá»­ dá»¥ng)
- CGPROGRAM/ENDCG (HLSLPROGRAM/ENDHLSL): chá»©a code cho cÃ¡c phÃ©p tÃ­nh toÃ¡n Ä‘á»“ há»a 

> LÃ½ do cÃ³ 2 loáº¡i lÃ  CG vá»›i HLSL thÃ¬ Ä‘Ã¢y cÃ¹ng lÃ  ngÃ´n ngá»¯ cho shader cá»§a nhÃ  Nvidia, HLSL lÃ  Ä‘á»“ má»›i ngon hÆ¡n vÃ  CG lÃ  Ä‘á»“ cÅ©

> Hiá»‡n táº¡i chÃºng ta cÃ³ HLSL sáº½ máº¡nh hÆ¡n cho DirectX (Ä‘á»“ cá»§a nhÃ  Microsoft), GLSL cho OpenGL (cÃ¡i api graphic nÃ y giá» hÆ¡i Ä‘uá»‘i so vá»›i Vulkan), CG thÃ¬ há»— trá»£ cáº£ 2.

> HLSL cÃ³ thá»ƒ há»— trá»£ má»i loáº¡i Render pipeline cá»§a Unity, cÃ²n CG thÃ¬ nhá»‹n vá»›i URP vÃ  HDRP, tuy nhiÃªn thÃ¬ migrate ráº¥t lÃ  dá»… nÃªn khÃ´ng Ä‘Ã¡ng lo.

**ğŸ’¡ TIP:**
HLSLINCLLUDE vÃ  CGINCLUDE cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m gá»n code thay vÃ¬ tá»‘ng táº¥t cáº£ vÃ o CGPROGRAM/HLSLPROGRAM

```csharp
Shader "Hidden/MyCoolCustomPostProcessingShader"
{
    HLSLINCLUDE

        #include "Packages/com.unity.postprocessing/PostProcessing/Shaders/StdLib.hlsl"

        TEXTURE2D_SAMPLER2D(_MainTex, sampler_MainTex);
        float4 _MainTex_TexelSize;
        
        struct v2f
        {
        };

        v2f Vert (AttributesDefault v)
        {
        }

        float4 Frag(v2f input) : SV_Target
        {
        }
    
    ENDHLSL
    
    SubShader
    {
        Cull Off ZWrite Off ZTest Always

        Pass
        {
            HLSLPROGRAM

                #pragma vertex Vert
                #pragma fragment Frag

            ENDHLSL
        }
    }
}
```

- Fallback: qua bÆ°á»›c xá»­ lÃ½ trong Pass thÃ¬ tá»± Ä‘á»™ng mÃ² tá»›i shader default Ä‘á»ƒ render


Ok, á»•n Ä‘á»‹nh tinh tháº§n sau khi bá»‹ nhá»“i nhÃ©t rá»“i chá»© ? giá» lÃ  tá»›i lÃºc á»©ng dá»¥ng luÃ´n nÃ¨

---

## Thá»±c HÃ nh
Má»› lÃ½ thuyáº¿t tháº¿ lÃ  Ä‘á»§ rá»“i, thá»±c hÃ nh nhá»‰ ? 1 lÃ¡ bÃ i khÃ´ng gian
ChÃºng ta sáº½ sá»­ dá»¥ng Built-in Render pipeline cá»§a Unity

image here

Äáº§u tiÃªn hÃ£y nÃ³i vá» máº·t Ã½ tÆ°á»Ÿng

Khi render ra má»™t táº¥m hÃ¬nh hay gÃ³c nhÃ¬n cá»§a camera, má»—i pixel trÃªn mÃ n hÃ¬nh sáº½ chá»©a nhiá»u giÃ¡ trá»‹, trong Ä‘Ã³ cÃ³ 1 giÃ¡ trá»‹ gá»i lÃ  stencil

ÄÃ¢y lÃ  1 shader chá»‰ cho phÃ©p render náº¿u nhÆ° nhá»¯ng pixel trÃªn mÃ n hÃ¬nh cÃ³ sá»‘ stencil há»£p vá»›i Ä‘iá»u kiá»‡n thÃ¬ cho Pass cÃ¡i shader (tá»©c lÃ  cho xem máº¥y mÃ³n cÃ³ stencil tÆ°Æ¡ng á»©ng)

Nghe hÆ¡i láº±ng nháº±ng nhÆ°ng nÃ³i chung lÃ  giá»‘ng Mask Effect, pixel trong vÃ¹ng mask thÃ¬ lá»™, ngoÃ i vÃ¹ng thÃ¬ giáº¥u

Äá»‘i vá»›i shader cá»§a táº¥m kÃ­nh mask chÃºng ta sáº½ dÃ¹ng Basic Shader vá»«a táº¡o á»Ÿ trÃªn vÃ  thÃªm vÃ o trong code 

```csharp
Stencil
{
    ref 1
    comp Always
    pass replace
}
```

NÃ³ mang nghÄ©a lÃ  vá»›i táº¥t cáº£ cÃ¡c pixel cÃ³ giÃ¡ trá»‹ stencil = 1 thÃ¬ nÃ³ cho pass lÃ  replace (thay tháº¿ cÃ¡c pixel báº±ng thá»© Ä‘Æ°á»£c duyá»‡t qua shader nÃ y)
váº­y lÃ  ta sáº½ cÃ³:

```csharp
Shader "Unlit/BasicShader"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 100

        //Pháº§n má»›i thÃªm vÃ o :D
        Stencil
        {
            ref 1
            comp Always
            pass replace
        }

        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            // make fog work
            #pragma multi_compile_fog

            #include "UnityCG.cginc"

            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
            };

            struct v2f
            {
                float2 uv : TEXCOORD0;
                UNITY_FOG_COORDS(1)
                float4 vertex : SV_POSITION;
            };

            sampler2D _MainTex;
            float4 _MainTex_ST;

            v2f vert (appdata v)
            {
                v2f o;
                o.vertex = UnityObjectToClipPos(v.vertex);
                o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                UNITY_TRANSFER_FOG(o,o.vertex);
                return o;
            }

            fixed4 frag (v2f i) : SV_Target
            {
                // sample the texture
                fixed4 col = tex2D(_MainTex, i.uv);
                // apply fog
                UNITY_APPLY_FOG(i.fogCoord, col);
                return col;
            }
            ENDCG
        }
    }
}
```
Chuá»™t pháº£i vÃ o file shader vÃ  **Create > Material** vÃ  gáº¯n vÃ o táº¥m kÃ­nh mask

Äá»‘i vá»›i nhá»¯ng mÃ³n muá»‘n Ä‘Æ°á»£c nhÃ¬n thÃ´ng qua táº¥m mask chÃºng ta sáº½ dÃ¹ng shader standard lÃ m vÃ­ dá»¥.
ChÃºng ta cÃ³ thá»ƒ chÃ¨n dÃ²ng nÃ y vÃ o báº¥t kÃ¬ shader nÃ o mÃ¬nh muá»‘n (miá»…n lÃ  shader Ä‘Ã³ Ä‘ang chÆ°a Ä‘á»¥ng tá»›i Stencil Buffer)

**Táº¡o Shader Standard Má»›i**:  
   - Trong Unity, chuyá»ƒn Ä‘áº¿n tab **Project** (thÆ°á»ng á»Ÿ phÃ­a dÆ°á»›i mÃ n hÃ¬nh).  
   - Nháº¥p chuá»™t pháº£i vÃ o thÆ° má»¥c **Assets** hoáº·c thÆ° má»¥c con mÃ  báº¡n muá»‘n lÆ°u shader.
   - Chá»n **Create > Shader > Standard Surface Shader**.
   - Äáº·t tÃªn tÃ¹y Ã½, á»Ÿ trong nÃ y mÃ¬nh sáº½ Ä‘áº·t lÃ  **MaskObject**

ThÃªm vÃ o chá»‰ xuáº¥t hiá»‡n khi giÃ¡ trá»‹ Stencil trÃ¹ng khi so sÃ¡nh vá»›i táº¥m mask:

```csharp
    Stencil
    {
        ref 1
        comp equal
    }
```

Tá»•ng káº¿t láº¡i ta sáº½ cÃ³:

```csharp
Shader "Custom/MaskObject"
{
    Properties
    {
        _Color ("Color", Color) = (1,1,1,1)
        _MainTex ("Albedo (RGB)", 2D) = "white" {}
        _Glossiness ("Smoothness", Range(0,1)) = 0.5
        _Metallic ("Metallic", Range(0,1)) = 0.0
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 200

        Stencil
        {
            ref 1
            comp equal
        }

        CGPROGRAM
        // Physically based Standard lighting model, and enable shadows on all light types
        #pragma surface surf Standard fullforwardshadows

        // Use shader model 3.0 target, to get nicer looking lighting
        #pragma target 3.0

        sampler2D _MainTex;

        struct Input
        {
            float2 uv_MainTex;
        };

        half _Glossiness;
        half _Metallic;
        fixed4 _Color;

        // Add instancing support for this shader. You need to check 'Enable Instancing' on materials that use the shader.
        // See https://docs.unity3d.com/Manual/GPUInstancing.html for more information about instancing.
        // #pragma instancing_options assumeuniformscaling
        UNITY_INSTANCING_BUFFER_START(Props)
            // put more per-instance properties here
        UNITY_INSTANCING_BUFFER_END(Props)

        void surf (Input IN, inout SurfaceOutputStandard o)
        {
            // Albedo comes from a texture tinted by color
            fixed4 c = tex2D(_MainTex, IN.uv_MainTex) * _Color;
            o.Albedo = c.rgb;
            // Metallic and smoothness come from slider variables
            o.Metallic = _Metallic;
            o.Smoothness = _Glossiness;
            o.Alpha = c.a;
        }
        ENDCG
    }
    FallBack "Diffuse"
}
```

Chuá»™t pháº£i vÃ o file shader vÃ  **Create > Material** vÃ  gáº¯n rá»“i gáº¯n cÃ¡i Material má»›i táº¡o lÃªn nhá»¯ng object muá»‘n hiá»ƒn thá»‹

VÃ¬ mÃ¬nh muá»‘n lÃ m nhiá»u hÆ¡n lÃ  1 máº·t cho lÃ¡ bÃ i nÃ y, cho nÃªn Ä‘á»ƒ cho phÃ©p sá»­ dá»¥ng láº¡i giÃ¡ trá»‹ nÃ y vá»›i nhiá»u material hÆ¡n nÃªn chÃºng ta sáº½ tinh chá»‰nh má»™t chÃºt

TrÆ°á»›c háº¿t lÃ  thay má»i dÃ²ng "ref 1" trong **cáº£ 2 shader** báº±ng (Nhá»› lÃ  cáº£ 2 shader Ä‘áº¥y, cÃ¡i gÃ¬ quan trá»ng nháº¯c láº¡i)

```csharp
     Ref[_StencilMask]
```

ThÃªm giÃ¡ trá»‹ á»Ÿ Properties Ä‘á»ƒ cho phÃ©p Material sá»­a qua inspector

```csharp
    Properties
    {
        //etc....
        _StencilMask("Stencil Mask", Int) = 1
    }
```

Giá» vá»›i setup tÆ°Æ¡ng tá»±, 2 máº·t 2 materials cho mask vÃ  sá»‘ stencil khÃ¡c nhau vÃ  setup nhá»¯ng Ä‘á»“ váº­t cá»§a má»—i hÆ°á»›ng cÃ³ stencil tÆ°Æ¡ng á»©ng vÃ  Ä‘Ã¢y lÃ  thÃ nh quáº£

gif here

Hmmmmmm, cÅ©ng khÃ¡ lÃ  Ä‘áº¹p, bÃ¢y giá» chÃºng ta hÃ£y loáº¡i bá» mÃ u cá»§a táº¥m Mask báº±ng viá»‡c loáº¡i bá» mÃ u sáº¯c cá»§a nÃ³ vá»›i cÃ¢u lá»‡nh

```csharp
    ColorMask 0
```

Vá»›i giÃ¡ trá»‹ lÃ  0 thÃ¬ má»i mÃ u trong cáº£ 4 kÃªnh mÃ u RGBA Ä‘á»u sáº½ bá»‹ lÆ°á»£c bá», vÃ  ngoÃ i ra cÃ²n 1 lÆ°u Ã½ ná»¯a, báº¡n cÃ³ thá»ƒ tháº¥y lÃ  nÃ³ Ä‘ang nhÃ¡y nhÃ¡y

NguyÃªn do lÃ  thá»© tá»± render cá»§a chÃºng trong Render Queue Ä‘ang báº±ng nhau nÃªn mÃ¡y tÃ­nh khÃ´ng biáº¿t váº½ cÃ¡i nÃ o trÆ°á»›c

Chá»‰ cáº§n Ä‘áº©y sá»‘ Render Queue cá»§a object hoáº·c cÃ¡i cá»•ng mask bÃ© hÆ¡n lÃ  Ä‘Æ°á»£c

**video here**

Chá»‰ cÃ²n 1 cÃ¡i lá»—i nhá» xÃ­u ná»¯a thÃ´i, cÃ³ thá»ƒ tháº¥y lÃ  náº¿u chÃºng ta Ä‘á»ƒ mÃ³n nÃ y á»Ÿ Ä‘áº±ng sau dÃ¹ Ä‘Ã£ Ä‘Æ°á»£c lá»c mÃ u thÃ¬ nÃ³ váº«n bá»‹ che máº¥t

LÃ½ do lÃ  vÃ¬ trong camera nÃ³ váº«n render ra á»Ÿ thÃ´ng sá»‘ depth (giÃ¡ trá»‹ biá»ƒu thá»‹ khoáº£ng cÃ¡ch)

**depth view image here**

Váº­y lÃ  chÃºng ta chá»‰ cáº§n báº£o lÃ  skip khÃ´ng váº½ táº¥m Mask nÃ y ná»¯a lÃ  xong 

```csharp
    Zwrite off
```

**compare image**


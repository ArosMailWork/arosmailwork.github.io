---
title: Shader Graph l√† kh√¥ng ƒë·ªß ? th·ª≠ HLSL nh√© ?
description: HLSL, m·ªü kh√≥a ti·ªÅm nƒÉng m·ªõi
author: ArosTheDev
date: 2025-2-15 00:00:00 +0700
categories: [Tutorial, Shader, Vietnamese]
tags: [Tutorial, Shader, Vietnamese]
---

L·ªùi ƒë·∫ßu m√¨nh mu·ªën n√≥i trong b√†i blog n√†y l√† c·∫£m ∆°n ƒë√£ b·∫•m v√†o b√†i post gi·∫≠t t√≠t ƒë·∫ßu n√†y, mong l√† n√≥ s·∫Ω gi√∫p √≠ch g√¨ ƒë√≥ cho m·ªçi ng∆∞·ªùi

## Shader Graph v√† gi·ªõi h·∫°n c·ªßa n√≥ 

N·∫øu m√† c√°c b·∫°n t·ª´ng m√≤ qua v·ªÅ shader graph th√¨ s·∫Ω th·∫•y n√≥ r·∫•t l√† ti·ªán trong vi·ªác s·ª≠ d·ª•ng v√† th√¢n thi·ªán v·ªõi ng∆∞·ªùi d√πng
T·∫•t nhi√™n l√† n√≥ v·∫´n r·∫•t l√† ƒë√°ng tin tuy nhi√™n n·∫øu mu·ªën l√†m 1 c√°i hi·ªáu ·ª©ng g√¨ ƒë√≥ n√≥ ho√†nh t√° tr√†ng h∆°n n·ªØa nh∆∞ l√† ........ m·ªôt l√° b√†i 2 kh√¥ng gian ch·∫≥ng h·∫°n ?

*gif here*

ƒê·ªëi v·ªõi shader graph chay th√¨ ch·∫Øc l√† ch·ªãu ch·∫øt, c√≤n n·∫øu d√πng node custom Function th√¨ b·∫°n s·∫Ω ph·∫£i ƒë√†o s√¢u h∆°n th·∫ø v√† c·ª• th·ªÉ ch√≠nh l√† HLSL!!!

ƒê√¢y ch√≠nh l√† c√°ch m√† b·ªô c√¥ng c·ª• shader graph th∆∞·ªùng hay d√πng ƒë·ªÉ l·∫•p li·∫øm cho nh·ªØng th·ª© m√† kh√¥ng h·ªÅ c√≥ node s·∫µn,
t·∫•t nhi√™n l√† c√≤n 1 c√°ch n·ªØa ƒë√≥ l√† s·ª≠ d·ª•ng nh·ªØng plugin t∆∞∆°ng t·ª± shader graph nh∆∞ Amplify Shader, 
nh∆∞ng khi ch√∫ng ta t·ªõi v·ªõi nh·ªØng hi·ªáu ·ª©ng ph·ª©c t·∫°p h∆°n nh∆∞ volumetric fog th√¨ nh·ªØng gi·ªõi h·∫°n t∆∞∆°ng t·ª± c≈©ng s·∫Ω x·∫£y ra.

V·∫≠y, l√†m c√°ch n√†o ƒë·ªÉ ch√∫ng ta c√≥ th·ªÉ t·∫°o ƒë∆∞·ª£c nh·ªØng th·ª© kinh kh·ªßng h∆°n th·∫ø ?

---

## L√Ω Thuy·∫øt
Xin gi·ªõi thi·ªáu v·ªõi c√°c ƒë·ªôc gi·∫£, ƒë√¢y l√† HLSL (High-Level Shading Language)

C·∫•u t·∫°o c·ªßa 1 shader khi nh√¨n v√†o c≈©ng kh√° l√† ƒë∆°n gi·∫£n

Gi·ªù h√£y th·ª≠ t·∫°o 1 shader m·∫∑c ƒë·ªãnh c·ªßa unity ƒë·ªÉ d·ªÖ h√¨nh dung h∆°n

### 1. **T·∫°o Shader M·ªõi**:  

   - Trong Unity, chuy·ªÉn ƒë·∫øn tab **Project** (th∆∞·ªùng ·ªü ph√≠a d∆∞·ªõi m√†n h√¨nh).  
   - Nh·∫•p chu·ªôt ph·∫£i v√†o th∆∞ m·ª•c **Assets** ho·∫∑c th∆∞ m·ª•c con m√† b·∫°n mu·ªën l∆∞u shader.  
   - Ch·ªçn **Create > Shader > Unlit Shader**.

### 2. **ƒê·∫∑t T√™n Cho Shader**:  

   - Sau khi ch·ªçn xong, Unity s·∫Ω t·∫°o ra m·ªôt file shader m·ªõi.  
   - ƒê·∫∑t t√™n file shader l√† `BasicShader.shader` ho·∫∑c `BasicShader`.

### 3. **M·ªü Shader V·ª´a T·∫°o**:  

   - Nh·∫•p ƒë√∫p chu·ªôt v√†o file `BasicShader.shader` ƒë·ªÉ m·ªü n√≥ b·∫±ng Code IDE (Visual Studio ho·∫∑c VSCode).

### 4. **C·∫•u Tr√∫c Shader Ban ƒê·∫ßu**:  

    L√∫c n√†y, code c·ªßa shader s·∫Ω tr√¥ng nh∆∞ sau (ƒë√¢y l√† m·∫´u c∆° b·∫£n Unity cung c·∫•p):

    ```csharp
    Shader "Unlit/BasicShader"
    {
        Properties
        {
            _MainTex ("Texture", 2D) = "white" {}
        }
        SubShader
        {
            Tags { "RenderType"="Opaque" }
            LOD 100

            Pass
            {
                CGPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                // make fog work
                #pragma multi_compile_fog

                #include "UnityCG.cginc"

                struct appdata
                {
                    float4 vertex : POSITION;
                    float2 uv : TEXCOORD0;
                };

                struct v2f
                {
                    float2 uv : TEXCOORD0;
                    UNITY_FOG_COORDS(1)
                    float4 vertex : SV_POSITION;
                };

                sampler2D _MainTex;
                float4 _MainTex_ST;

                v2f vert (appdata v)
                {
                    v2f o;
                    o.vertex = UnityObjectToClipPos(v.vertex);
                    o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                    UNITY_TRANSFER_FOG(o,o.vertex);
                    return o;
                }

                fixed4 frag (v2f i) : SV_Target
                {
                    // sample the texture
                    fixed4 col = tex2D(_MainTex, i.uv);
                    // apply fog
                    UNITY_APPLY_FOG(i.fogCoord, col);
                    return col;
                }
                ENDCG
            }
        }
    }
   ```

   Gi·ªù h√£y c√πng ph√¢n t√≠ch qua c·∫•u tr√∫c c·ªßa 1 file Shader nh√©, v·ªõi 1 v√†i qu·∫πt x√≥a ƒëi ch√∫ng ta s·∫Ω c√≥:

   ```csharp
    Shader "Custom/BasicShader"
    {
        Properties
        {
            _MainTex ("Texture", 2D) = "white" {}
        }

        SubShader
        {
            Cull Off ZWrite Off ZTest Always    //thu·ªôc t√≠nh ngo√†i c√≥ th·ªÉ d√πng trong shader
            LOD 200                             //thu·ªôc t√≠nh ngo√†i c√≥ th·ªÉ d√πng trong shader

            Tags { "RenderType"="Opaque" }
            
            Pass
            {
                CGPROGRAM

                #pragma vertex vert
                #pragma fragment frag

                #include "UnityCG.cginc"

                struct appdata
                { };

                struct v2f
                { };

                sampler2D _MainTex;
                float4 _MainTex_ST;

                v2f vert (appdata v)
                {
                }

                fixed4 frag (v2f i) : SV_Target
                {
                }

                ENDCG
            }
        }

        
        Fallback "Standard"
    }
```

ƒê√¢y ch√≠nh l√† c·∫•u tr√∫c c∆° b·∫£n c·ªßa 1 file shader:

- Properties: n∆°i show ra c√°c gi√° tr·ªã view tr√™n inspector, t√πy √Ω, kh√¥ng nh·∫•t thi·∫øt ph·∫£i c√≥
- SubShader: Khu v·ª±c ch·ª©a c√°c Pass (c√°i n√†y s·∫Ω c√≤n ƒë∆∞·ª£c nh·∫Øc l·∫°i trong 1 b√†i v·ªÅ Replacement Shader)

+ Pass: Ch·ª©a c√°c b∆∞·ªõc th·ª±c thi cho vertex shader ho·∫∑c fragment shader (Surface Shader kh√¥ng ph·∫£i 1 shader l·∫ª, s·∫Ω ƒë∆∞·ª£c l√†m r√µ trong 1 b√†i n√≥i v·ªÅ low-level graphic programming)

**üìù NOTE:**  
> M·ªôt s·ªë thu·ªôc t√≠nh render (kh√¥ng c√≥ trong file gen m·∫∑c ƒë·ªãnh)
Cull Off, ZWrite Off, ZTest Always, LOD : 1 s·ªë thu·ªôc t√≠nh kh√°c li√™n quan t·ªõi render (m·∫•y c√°i n√†y r·∫•t ƒëa d·∫°ng v√† lo·∫±ng ngo·∫±ng, s·∫Ω c√≥ nh·ªØng hi·ªáu ·ª©ng s·ª≠ d·ª•ng)
- CGPROGRAM/ENDCG (HLSLPROGRAM/ENDHLSL): ch·ª©a code cho c√°c ph√©p t√≠nh to√°n ƒë·ªì h·ªça 

> L√Ω do c√≥ 2 lo·∫°i l√† CG v·ªõi HLSL th√¨ ƒë√¢y c√πng l√† ng√¥n ng·ªØ cho shader c·ªßa nh√† Nvidia, HLSL l√† ƒë·ªì m·ªõi ngon h∆°n v√† CG l√† ƒë·ªì c≈©

> Hi·ªán t·∫°i ch√∫ng ta c√≥ HLSL s·∫Ω m·∫°nh h∆°n cho DirectX (ƒë·ªì c·ªßa nh√† Microsoft), GLSL cho OpenGL (c√°i api graphic n√†y gi·ªù h∆°i ƒëu·ªëi so v·ªõi Vulkan), CG th√¨ h·ªó tr·ª£ c·∫£ 2.

> HLSL c√≥ th·ªÉ h·ªó tr·ª£ m·ªçi lo·∫°i Render pipeline c·ªßa Unity, c√≤n CG th√¨ nh·ªãn v·ªõi URP v√† HDRP, tuy nhi√™n th√¨ migrate r·∫•t l√† d·ªÖ n√™n kh√¥ng ƒë√°ng lo.

**üí° TIP:**
HLSLINCLLUDE v√† CGINCLUDE c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l√†m g·ªçn code thay v√¨ t·ªëng t·∫•t c·∫£ v√†o CGPROGRAM/HLSLPROGRAM

```csharp
Shader "Hidden/MyCoolCustomPostProcessingShader"
{
    HLSLINCLUDE

        #include "Packages/com.unity.postprocessing/PostProcessing/Shaders/StdLib.hlsl"

        TEXTURE2D_SAMPLER2D(_MainTex, sampler_MainTex);
        float4 _MainTex_TexelSize;
        
        struct v2f
        {
        };

        v2f Vert (AttributesDefault v)
        {
        }

        float4 Frag(v2f input) : SV_Target
        {
        }
    
    ENDHLSL
    
    SubShader
    {
        Cull Off ZWrite Off ZTest Always

        Pass
        {
            HLSLPROGRAM

                #pragma vertex Vert
                #pragma fragment Frag

            ENDHLSL
        }
    }
}
```

- Fallback: qua b∆∞·ªõc x·ª≠ l√Ω trong Pass th√¨ t·ª± ƒë·ªông m√≤ t·ªõi shader default ƒë·ªÉ render


Ok, ·ªïn ƒë·ªãnh tinh th·∫ßn sau khi b·ªã nh·ªìi nh√©t r·ªìi ch·ª© ? gi·ªù l√† t·ªõi l√∫c ·ª©ng d·ª•ng lu√¥n n√®

---

## Th·ª±c H√†nh
M·ªõ l√Ω thuy·∫øt th·∫ø l√† ƒë·ªß r·ªìi, th·ª±c h√†nh nh·ªâ ? 1 l√° b√†i kh√¥ng gian
Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Built-in Render pipeline c·ªßa Unity

image here

ƒê·∫ßu ti√™n h√£y n√≥i v·ªÅ m·∫∑t √Ω t∆∞·ªüng

Khi render ra m·ªôt t·∫•m h√¨nh hay g√≥c nh√¨n c·ªßa camera, m·ªói pixel tr√™n m√†n h√¨nh s·∫Ω ch·ª©a nhi·ªÅu gi√° tr·ªã, trong ƒë√≥ c√≥ 1 gi√° tr·ªã g·ªçi l√† stencil

ƒê√¢y l√† 1 shader ch·ªâ cho ph√©p render n·∫øu nh∆∞ nh·ªØng pixel tr√™n m√†n h√¨nh c√≥ s·ªë stencil h·ª£p v·ªõi ƒëi·ªÅu ki·ªán th√¨ cho Pass c√°i shader (t·ª©c l√† cho xem m·∫•y m√≥n c√≥ stencil t∆∞∆°ng ·ª©ng)

Nghe h∆°i l·∫±ng nh·∫±ng nh∆∞ng n√≥i chung l√† gi·ªëng Mask Effect, pixel trong v√πng mask th√¨ l·ªô, ngo√†i v√πng th√¨ gi·∫•u

ƒê·ªëi v·ªõi shader c·ªßa t·∫•m k√≠nh mask ch√∫ng ta s·∫Ω d√πng Basic Shader v·ª´a t·∫°o ·ªü tr√™n v√† th√™m v√†o trong code 

```csharp
Stencil
{
    ref 1
    comp Always
    pass replace
}
```

N√≥ mang nghƒ©a l√† v·ªõi t·∫•t c·∫£ c√°c pixel c√≥ gi√° tr·ªã stencil = 1 th√¨ n√≥ cho pass l√† replace (thay th·∫ø c√°c pixel b·∫±ng th·ª© ƒë∆∞·ª£c duy·ªát qua shader n√†y)
v·∫≠y l√† ta s·∫Ω c√≥:

```csharp
Shader "Unlit/BasicShader"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 100

        //Ph·∫ßn m·ªõi th√™m v√†o :D
        Stencil
        {
            ref 1
            comp Always
            pass replace
        }

        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            // make fog work
            #pragma multi_compile_fog

            #include "UnityCG.cginc"

            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
            };

            struct v2f
            {
                float2 uv : TEXCOORD0;
                UNITY_FOG_COORDS(1)
                float4 vertex : SV_POSITION;
            };

            sampler2D _MainTex;
            float4 _MainTex_ST;

            v2f vert (appdata v)
            {
                v2f o;
                o.vertex = UnityObjectToClipPos(v.vertex);
                o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                UNITY_TRANSFER_FOG(o,o.vertex);
                return o;
            }

            fixed4 frag (v2f i) : SV_Target
            {
                // sample the texture
                fixed4 col = tex2D(_MainTex, i.uv);
                // apply fog
                UNITY_APPLY_FOG(i.fogCoord, col);
                return col;
            }
            ENDCG
        }
    }
}
```
Chu·ªôt ph·∫£i v√†o file shader v√† **Create > Material** v√† g·∫Øn v√†o t·∫•m k√≠nh mask

ƒê·ªëi v·ªõi nh·ªØng m√≥n mu·ªën ƒë∆∞·ª£c nh√¨n th√¥ng qua t·∫•m mask ch√∫ng ta s·∫Ω d√πng shader standard l√†m v√≠ d·ª•.
Ch√∫ng ta c√≥ th·ªÉ ch√®n d√≤ng n√†y v√†o b·∫•t k√¨ shader n√†o m√¨nh mu·ªën (mi·ªÖn l√† shader ƒë√≥ ƒëang ch∆∞a ƒë·ª•ng t·ªõi Stencil Buffer)

**T·∫°o Shader Standard M·ªõi**:  
   - Trong Unity, chuy·ªÉn ƒë·∫øn tab **Project** (th∆∞·ªùng ·ªü ph√≠a d∆∞·ªõi m√†n h√¨nh).  
   - Nh·∫•p chu·ªôt ph·∫£i v√†o th∆∞ m·ª•c **Assets** ho·∫∑c th∆∞ m·ª•c con m√† b·∫°n mu·ªën l∆∞u shader.
   - Ch·ªçn **Create > Shader > Standard Surface Shader**.
   - ƒê·∫∑t t√™n t√πy √Ω, ·ªü trong n√†y m√¨nh s·∫Ω ƒë·∫∑t l√† **MaskObject**

Th√™m v√†o ch·ªâ xu·∫•t hi·ªán khi gi√° tr·ªã Stencil tr√πng khi so s√°nh v·ªõi t·∫•m mask:

```csharp
    Stencil
    {
        ref 1
        comp equal
    }
```

T·ªïng k·∫øt l·∫°i ta s·∫Ω c√≥:

```csharp
Shader "Custom/MaskObject"
{
    Properties
    {
        _Color ("Color", Color) = (1,1,1,1)
        _MainTex ("Albedo (RGB)", 2D) = "white" {}
        _Glossiness ("Smoothness", Range(0,1)) = 0.5
        _Metallic ("Metallic", Range(0,1)) = 0.0
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 200

        Stencil
        {
            ref 1
            comp equal
        }

        CGPROGRAM
        // Physically based Standard lighting model, and enable shadows on all light types
        #pragma surface surf Standard fullforwardshadows

        // Use shader model 3.0 target, to get nicer looking lighting
        #pragma target 3.0

        sampler2D _MainTex;

        struct Input
        {
            float2 uv_MainTex;
        };

        half _Glossiness;
        half _Metallic;
        fixed4 _Color;

        // Add instancing support for this shader. You need to check 'Enable Instancing' on materials that use the shader.
        // See https://docs.unity3d.com/Manual/GPUInstancing.html for more information about instancing.
        // #pragma instancing_options assumeuniformscaling
        UNITY_INSTANCING_BUFFER_START(Props)
            // put more per-instance properties here
        UNITY_INSTANCING_BUFFER_END(Props)

        void surf (Input IN, inout SurfaceOutputStandard o)
        {
            // Albedo comes from a texture tinted by color
            fixed4 c = tex2D(_MainTex, IN.uv_MainTex) * _Color;
            o.Albedo = c.rgb;
            // Metallic and smoothness come from slider variables
            o.Metallic = _Metallic;
            o.Smoothness = _Glossiness;
            o.Alpha = c.a;
        }
        ENDCG
    }
    FallBack "Diffuse"
}
```

Chu·ªôt ph·∫£i v√†o file shader v√† **Create > Material** v√† g·∫Øn r·ªìi g·∫Øn c√°i Material m·ªõi t·∫°o l√™n nh·ªØng object mu·ªën hi·ªÉn th·ªã

V√¨ m√¨nh mu·ªën l√†m nhi·ªÅu h∆°n l√† 1 m·∫∑t cho l√° b√†i n√†y, cho n√™n ƒë·ªÉ cho ph√©p s·ª≠ d·ª•ng l·∫°i gi√° tr·ªã n√†y v·ªõi nhi·ªÅu material h∆°n n√™n ch√∫ng ta s·∫Ω tinh ch·ªânh m·ªôt ch√∫t

Tr∆∞·ªõc h·∫øt l√† thay m·ªçi d√≤ng "ref 1" trong **c·∫£ 2 shader** b·∫±ng (Nh·ªõ l√† c·∫£ 2 shader ƒë·∫•y, c√°i g√¨ quan tr·ªçng nh·∫Øc l·∫°i)

```csharp
     Ref[_StencilMask]
```

Th√™m gi√° tr·ªã ·ªü Properties ƒë·ªÉ cho ph√©p Material s·ª≠a qua inspector

```csharp
    Properties
    {
        //etc....
        _StencilMask("Stencil Mask", Int) = 1
    }
```

Gi·ªù v·ªõi setup t∆∞∆°ng t·ª±, 2 m·∫∑t 2 materials cho mask v√† s·ªë stencil kh√°c nhau v√† setup nh·ªØng ƒë·ªì v·∫≠t c·ªßa m·ªói h∆∞·ªõng c√≥ stencil t∆∞∆°ng ·ª©ng v√† ƒë√¢y l√† th√†nh qu·∫£

gif here

Hmmmmmm, c≈©ng kh√° l√† ƒë·∫πp, b√¢y gi·ªù ch√∫ng ta h√£y lo·∫°i b·ªè m√†u c·ªßa t·∫•m Mask b·∫±ng vi·ªác lo·∫°i b·ªè m√†u s·∫Øc c·ªßa n√≥ v·ªõi c√¢u l·ªánh

```csharp
    ColorMask 0
```

V·ªõi gi√° tr·ªã l√† 0 th√¨ m·ªçi m√†u trong c·∫£ 4 k√™nh m√†u RGBA ƒë·ªÅu s·∫Ω b·ªã l∆∞·ª£c b·ªè, v√† ngo√†i ra c√≤n 1 l∆∞u √Ω n·ªØa, b·∫°n c√≥ th·ªÉ th·∫•y l√† n√≥ ƒëang nh√°y nh√°y

Nguy√™n do l√† th·ª© t·ª± render c·ªßa ch√∫ng trong Render Queue ƒëang b·∫±ng nhau n√™n m√°y t√≠nh kh√¥ng bi·∫øt v·∫Ω c√°i n√†o tr∆∞·ªõc

Ch·ªâ c·∫ßn ƒë·∫©y s·ªë Render Queue c·ªßa object ho·∫∑c c√°i c·ªïng mask b√© h∆°n l√† ƒë∆∞·ª£c

**video here**

Ch·ªâ c√≤n 1 c√°i l·ªói nh·ªè x√≠u n·ªØa th√¥i, c√≥ th·ªÉ th·∫•y l√† n·∫øu ch√∫ng ta ƒë·ªÉ m√≥n n√†y ·ªü ƒë·∫±ng sau d√π ƒë√£ ƒë∆∞·ª£c l·ªçc m√†u th√¨ n√≥ v·∫´n b·ªã che m·∫•t

L√Ω do l√† v√¨ trong camera n√≥ v·∫´n render ra ·ªü th√¥ng s·ªë depth (gi√° tr·ªã bi·ªÉu th·ªã kho·∫£ng c√°ch)

**depth view image here**

V·∫≠y l√† ch√∫ng ta ch·ªâ c·∫ßn b·∫£o l√† skip kh√¥ng v·∫Ω t·∫•m Mask n√†y n·ªØa l√† xong 

```csharp
    Zwrite off
```

**compare image**

